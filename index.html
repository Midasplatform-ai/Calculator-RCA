<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calculator RCA pentru asigura»õi cu risc ridicat - Formula BAAR oficialƒÉ. Calcul automat sau manual al primei recomandate.">
    <title>Midas - Calculator RCA - Prima RecomandatƒÉ Risc Ridicat | BAAR</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f5f7ff',
                            100: '#ebf0ff',
                            500: '#667eea',
                            600: '#5a67d8',
                            700: '#4c51bf',
                        },
                        secondary: {
                            500: '#764ba2',
                            600: '#6b3fa0',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom animations and styles */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        /* Tab transition */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        /* Upload area dragover effect */
        .upload-area.dragover {
            background-color: #e6fffa !important;
            border-color: #667eea !important;
            transform: scale(1.02);
        }

        /* Smooth transitions */
        * {
            transition: all 0.2s ease-out;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Dark radial gradient background */
        body {
            background: radial-gradient(at top center, #013169 10%, #020307 75%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Main Container -->
    <div class="min-h-screen py-6 px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto">

            <!-- Header -->
            <header class="text-center mb-8 fade-in">
                <div class="inline-block bg-white/10 backdrop-blur-sm rounded-full px-4 py-2 mb-4">
                    <span class="text-white text-sm font-semibold">üöó Calculator Oficial BAAR</span>
                </div>
                <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-3">
                    Calculator RCA - Risc Ridicat
                </h1>
                <p class="text-primary-50 text-base sm:text-lg">
                    Calcul PrimƒÉ RecomandatƒÉ conform Avizul ASF nr. 121/2024
                </p>
            </header>

            <!-- Formula Box -->
            <div class="bg-white rounded-2xl shadow-2xl p-6 mb-6 fade-in">
                <h2 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <span class="text-2xl">üìê</span>
                    <span>Formula de calcul:</span>
                </h2>
                <div class="bg-gradient-to-r from-primary-50 to-blue-50 rounded-lg p-4">
                    <code class="text-primary-700 font-bold text-sm sm:text-base block">
                        Pr = {TR √ó 1.36 + [(PO1 + PO2 + PO3) √∑ 3] √ó 64%} √∑ 2
                    </code>
                </div>
                <div class="mt-3 text-xs sm:text-sm text-gray-600 space-y-1">
                    <p><strong>Pr</strong> = Prima RecomandatƒÉ (rezultat)</p>
                    <p><strong>TR</strong> = Tarif Referin»õƒÉ ASF | <strong>N</strong> = 1.36 (constant)</p>
                    <p><strong>PO1, PO2, PO3</strong> = Prime nete din oferte (12 luni fƒÉrƒÉ decontare directƒÉ)</p>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="bg-white rounded-t-2xl shadow-2xl overflow-hidden">
                <div class="flex border-b border-gray-200">
                    <button
                        id="tab-manual"
                        class="flex-1 px-4 sm:px-6 py-4 text-sm sm:text-base font-semibold text-gray-700 border-b-2 border-primary-500 bg-primary-50 focus:outline-none"
                        onclick="switchTab('manual')"
                    >
                        <span class="block sm:inline">‚å®Ô∏è</span>
                        <span class="block sm:inline mt-1 sm:mt-0">Intrare ManualƒÉ</span>
                    </button>
                    <button
                        id="tab-auto"
                        class="flex-1 px-4 sm:px-6 py-4 text-sm sm:text-base font-semibold text-gray-500 border-b-2 border-transparent hover:bg-gray-50 focus:outline-none"
                        onclick="switchTab('auto')"
                    >
                        <span class="block sm:inline">ü§ñ</span>
                        <span class="block sm:inline mt-1 sm:mt-0">Upload PDF Automat</span>
                    </button>
                </div>

                <!-- Manual Input Form -->
                <div id="content-manual" class="tab-content active p-6 sm:p-8">
                    <div class="mb-6">
                        <div class="bg-blue-50 border-l-4 border-blue-500 rounded-r-lg p-4 mb-6">
                            <p class="text-sm text-blue-900">
                                <strong>‚ÑπÔ∏è Instruc»õiuni:</strong> Introduce»õi <strong>TR</strong> din tabelul ASF »ôi cele <strong>3 prime nete</strong> din sec»õiunea "Oferta 12 luni fara decontare directa" (TOTAL).
                            </p>
                        </div>
                    </div>

                    <form id="manualForm" class="space-y-6">
                        <!-- TR Input -->
                        <div>
                            <label for="manual-TR" class="block text-sm font-semibold text-gray-700 mb-2">
                                Tarif de Referin»õƒÉ (TR) <span class="text-red-500">*</span>
                            </label>
                            <input
                                type="number"
                                id="manual-TR"
                                name="TR"
                                step="0.01"
                                min="0.01"
                                placeholder="Ex: 2156.00"
                                required
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary-500 text-base"
                            />
                            <div class="mt-2 space-y-1">
                                <p class="text-xs sm:text-sm text-gray-500">
                                    GƒÉsi»õi TR √Æn tabelul oficial ASF conform caracteristicilor vehiculului
                                </p>
                                <a
                                    href="https://www.baar.ro/wp-content/uploads/2025/11/Tarife-RCA-de-referinta-ASF-NOIEMBRIE-2025.pdf"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="inline-flex items-center gap-2 text-sm font-semibold text-primary-600 hover:text-primary-700 hover:underline transition-all"
                                >
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <span>üìã DescarcƒÉ Tabelul Oficial RCA (Decembrie 2024)</span>
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </a>
                            </div>
                        </div>

                        <!-- PO1 Input -->
                        <div>
                            <label for="manual-PO1" class="block text-sm font-semibold text-gray-700 mb-2">
                                Prima OfertƒÉ 1 NetƒÉ (PO1) <span class="text-red-500">*</span>
                            </label>
                            <input
                                type="number"
                                id="manual-PO1"
                                name="PO1"
                                step="0.01"
                                min="0.01"
                                placeholder="Ex: 1160.27"
                                required
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary-500 text-base"
                            />
                            <p class="mt-2 text-xs sm:text-sm text-gray-500">
                                Valoarea NetƒÉ din prima ofertƒÉ (fƒÉrƒÉ decontare directƒÉ)
                            </p>
                        </div>

                        <!-- PO2 Input -->
                        <div>
                            <label for="manual-PO2" class="block text-sm font-semibold text-gray-700 mb-2">
                                Prima OfertƒÉ 2 NetƒÉ (PO2) <span class="text-red-500">*</span>
                            </label>
                            <input
                                type="number"
                                id="manual-PO2"
                                name="PO2"
                                step="0.01"
                                min="0.01"
                                placeholder="Ex: 1178.53"
                                required
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary-500 text-base"
                            />
                            <p class="mt-2 text-xs sm:text-sm text-gray-500">
                                A doua ofertƒÉ NetƒÉ (din alt asigurƒÉtor)
                            </p>
                        </div>

                        <!-- PO3 Input -->
                        <div>
                            <label for="manual-PO3" class="block text-sm font-semibold text-gray-700 mb-2">
                                Prima OfertƒÉ 3 NetƒÉ (PO3) <span class="text-red-500">*</span>
                            </label>
                            <input
                                type="number"
                                id="manual-PO3"
                                name="PO3"
                                step="0.01"
                                min="0.01"
                                placeholder="Ex: 1226.73"
                                required
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary-500 text-base"
                            />
                            <p class="mt-2 text-xs sm:text-sm text-gray-500">
                                A treia ofertƒÉ NetƒÉ (din alt asigurƒÉtor)
                            </p>
                        </div>

                        <!-- Submit Button -->
                        <button
                            type="submit"
                            class="w-full bg-gradient-to-r from-primary-500 to-secondary-500 text-white font-bold py-4 px-6 rounded-lg hover:shadow-xl hover:-translate-y-1 focus:outline-none focus:ring-4 focus:ring-primary-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-base sm:text-lg"
                            id="manual-submit-btn"
                        >
                            CalculeazƒÉ Prima RecomandatƒÉ
                        </button>
                    </form>

                    <!-- Manual Loading -->
                    <div id="manual-loading" class="hidden mt-6 text-center">
                        <div class="spinner mx-auto mb-3"></div>
                        <p class="text-primary-600 font-semibold">Se calculeazƒÉ...</p>
                    </div>

                    <!-- Manual Result -->
                    <div id="manual-result" class="mt-6 hidden"></div>
                </div>

                <!-- Automated Upload Form -->
                <div id="content-auto" class="tab-content p-6 sm:p-8">
                    <div class="mb-6">
                        <div class="bg-blue-50 border-l-4 border-blue-500 rounded-r-lg p-4">
                            <p class="text-sm text-blue-900 mb-2">
                                <strong>ü§ñ Automatizare completƒÉ:</strong>
                            </p>
                            <ul class="text-xs sm:text-sm text-blue-800 space-y-1 ml-5 list-disc">
                                <li>Extrage automat datele vehiculului »ôi asiguratului daca introduceti documentul PDF generat pe platforma Destine (cu oferta intre 6 si 12 luni)</li>
                                <li>IdentificƒÉ TR din tabelul ASF</li>
                                <li>Extrage PO1, PO2, PO3 din PDF</li>
                                <li>CalculeazƒÉ Prima RecomandatƒÉ instant (fara decontare directa)</li>
                            </ul>
                            <p class="text-xs sm:text-sm text-blue-600">
                                <strong>üìÑ NotƒÉ:</strong> Asigura»õi-vƒÉ cƒÉ PDF-ul √ÆncƒÉrcat este o ofertƒÉ RCA validƒÉ pentru 12 luni. Iar in caz de eroare va rugam sa folositi intrarea manuala.
                            </p>
                        </div>
                    </div>

                    <form id="autoForm">
                        <!-- Upload Area -->
                        <div
                            id="upload-area"
                            class="upload-area border-3 border-dashed border-gray-300 rounded-xl p-8 sm:p-12 text-center cursor-pointer bg-gray-50 hover:bg-gray-100 hover:border-primary-400 transition-all"
                        >
                            <div class="text-5xl sm:text-6xl mb-4">üìÑ</div>
                            <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-2">
                                √éncarcƒÉ Oferta RCA (PDF)
                            </h3>
                            <p class="text-sm sm:text-base text-gray-600">
                                Trage fi»ôierul aici sau click pentru a selecta
                            </p>
                            <p class="text-xs text-gray-500 mt-2">
                                Format acceptat: PDF (max 10MB)
                            </p>
                        </div>

                        <input
                            type="file"
                            id="pdf-input"
                            accept=".pdf"
                            class="hidden"
                            required
                        />

                        <!-- File Info -->
                        <div id="file-info" class="hidden mt-4 bg-teal-50 border-2 border-teal-300 rounded-lg p-4">
                            <p class="font-semibold text-teal-900" id="file-name"></p>
                            <p class="text-sm text-teal-700 mt-1" id="file-size"></p>
                        </div>

                        <!-- Submit Button -->
                        <button
                            type="submit"
                            id="auto-submit-btn"
                            disabled
                            class="w-full mt-6 bg-gradient-to-r from-primary-500 to-secondary-500 text-white font-bold py-4 px-6 rounded-lg hover:shadow-xl hover:-translate-y-1 focus:outline-none focus:ring-4 focus:ring-primary-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-base sm:text-lg"
                        >
                            ProceseazƒÉ PDF »ôi CalculeazƒÉ
                        </button>

                        <!-- Reset Button -->
                        <button
                            type="button"
                            id="auto-reset-btn"
                            class="hidden w-full mt-3 bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-lg hover:bg-gray-300 focus:outline-none text-sm sm:text-base"
                        >
                            √éncarcƒÉ Alt Fi»ôier
                        </button>
                    </form>

                    <!-- Auto Loading -->
                    <div id="auto-loading" class="hidden mt-6 text-center">
                        <div class="spinner mx-auto mb-3"></div>
                        <p class="text-primary-600 font-semibold">Se proceseazƒÉ PDF-ul...</p>
                    </div>

                    <!-- Auto Result -->
                    <div id="auto-result" class="mt-6 hidden"></div>
                </div>
            </div>

            <!-- Footer Info -->
            <div class="mt-8 text-center text-white/80 text-xs sm:text-sm space-y-2 px-4">
                <p>
                    <strong>Conform:</strong> Legea nr. 132/2017 »ôi Norma A.S.F. nr. 20/2017
                </p>
                <p>
                    Formula valabilƒÉ de la 01.07.2025 | Avizul ASF nr. 121/19.04.2024
                </p>
                <p class="mt-4">
                    <a href="https://www.baar.ro" target="_blank" class="underline hover:text-white">
                        Biroul AsigurƒÉtorilor de Autovehicule din Rom√¢nia (BAAR)
                    </a>
                </p>
                <p>¬© 2025 Midas Solutions. Toate drepturile rezervate.</p>
            </div>
            <img src="https://i.pinimg.com/736x/47/8e/4e/478e4e95f4bf8d1452e92134e9f872fa.jpg" class="h-12 w-12 mx-auto" alt="midas logo">
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ========================================
        // CONFIGURATION - UPDATE THESE URLs
        // ========================================
        const WEBHOOK_MANUAL = 'https://midas21.app.n8n.cloud/webhook/rca-calculator-manual';
        const WEBHOOK_AUTO = 'https://midas21.app.n8n.cloud/webhook/rca-calculator-automated';

        // ========================================
        // TAB SWITCHING
        // ========================================
        function switchTab(tab) {
            const tabButtons = {
                manual: document.getElementById('tab-manual'),
                auto: document.getElementById('tab-auto')
            };

            const tabContents = {
                manual: document.getElementById('content-manual'),
                auto: document.getElementById('content-auto')
            };

            // Reset all tabs
            Object.keys(tabButtons).forEach(key => {
                tabButtons[key].classList.remove('border-primary-500', 'bg-primary-50', 'text-gray-700');
                tabButtons[key].classList.add('border-transparent', 'text-gray-500');
                tabContents[key].classList.remove('active');
            });

            // Activate selected tab
            tabButtons[tab].classList.add('border-primary-500', 'bg-primary-50', 'text-gray-700');
            tabButtons[tab].classList.remove('border-transparent', 'text-gray-500');
            tabContents[tab].classList.add('active');
        }

        // ========================================
        // LOCAL CALCULATION FUNCTION
        // ========================================
        function calculatePremiumLocal(data) {
            // Extract input values
            const TR = parseFloat(data.TR || 0);
            const PO1 = parseFloat(data.PO1 || 0);
            const PO2 = parseFloat(data.PO2 || 0);
            const PO3 = parseFloat(data.PO3 || 0);

            // Validation
            const errors = [];
            if (TR <= 0) errors.push('TR (Tarif de Referin»õƒÉ) trebuie sƒÉ fie mai mare dec√¢t 0');
            if (PO1 <= 0) errors.push('PO1 (Prima OfertƒÉ 1) trebuie sƒÉ fie mai mare dec√¢t 0');
            if (PO2 <= 0) errors.push('PO2 (Prima OfertƒÉ 2) trebuie sƒÉ fie mai mare dec√¢t 0');
            if (PO3 <= 0) errors.push('PO3 (Prima OfertƒÉ 3) trebuie sƒÉ fie mai mare dec√¢t 0');

            if (errors.length > 0) {
                return {
                    success: false,
                    errors: errors,
                    message: 'Validare e»ôuatƒÉ. VƒÉ rugƒÉm sƒÉ verifica»õi datele introduse.'
                };
            }

            // Constants
            const N = 1.36;
            const FACTOR = 0.64; // 64%

            // Step 1: Calculate average of 3 offers
            const averagePO = (PO1 + PO2 + PO3) / 3;

            // Step 2: Apply 64% to average
            const poComponent = averagePO * FACTOR;

            // Step 3: Multiply TR by N
            const trComponent = TR * N;

            // Step 4: Add components and divide by 2
            const Pr = (trComponent + poComponent) / 2;

            // Round to 2 decimal places
            const PrRounded = Math.round(Pr * 100) / 100;

            // Calculation details for transparency
            const calculationDetails = {
                step1_averagePO: Math.round(averagePO * 100) / 100,
                step2_poComponent: Math.round(poComponent * 100) / 100,
                step3_trComponent: Math.round(trComponent * 100) / 100,
                step4_sum: Math.round((trComponent + poComponent) * 100) / 100,
                step5_finalPr: PrRounded
            };

            return {
                success: true,
                inputs: {
                    TR: TR,
                    PO1: PO1,
                    PO2: PO2,
                    PO3: PO3,
                    constantN: N
                },
                result: {
                    primaRecomandata: PrRounded,
                    currency: 'RON',
                    valabilitate: '12 luni'
                },
                calculationDetails: calculationDetails,
                formula: 'Pr = {TR √ó 1.36 + [(PO1 + PO2 + PO3) √∑ 3] √ó 64%} √∑ 2',
                message: `Prima RecomandatƒÉ calculatƒÉ: ${PrRounded} RON pentru 12 luni`
            };
        }

        // ========================================
        // MANUAL FORM HANDLER
        // ========================================
        const manualForm = document.getElementById('manualForm');
        const manualLoading = document.getElementById('manual-loading');
        const manualResult = document.getElementById('manual-result');
        const manualSubmitBtn = document.getElementById('manual-submit-btn');

        manualForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const formData = {
                TR: parseFloat(document.getElementById('manual-TR').value),
                PO1: parseFloat(document.getElementById('manual-PO1').value),
                PO2: parseFloat(document.getElementById('manual-PO2').value),
                PO3: parseFloat(document.getElementById('manual-PO3').value)
            };

            // Show loading (brief visual feedback)
            manualSubmitBtn.disabled = true;
            manualLoading.classList.remove('hidden');
            manualResult.classList.add('hidden');

            // Simulate brief processing delay for UX (optional)
            setTimeout(() => {
                // Calculate locally (no n8n call needed)
                const result = calculatePremiumLocal(formData);

                // Hide loading
                manualLoading.classList.add('hidden');
                manualSubmitBtn.disabled = false;

                // Display result
                if (result.success) {
                    showManualSuccess(result);
                } else {
                    showError(manualResult, result.message || 'Eroare la calcul', result.errors);
                }
            }, 300); // 300ms delay for smooth UX
        });

        function showManualSuccess(result) {
            const pr = result.result.primaRecomandata;
            const details = result.calculationDetails;
            const inputs = result.inputs;

            manualResult.innerHTML = `
                <div class="bg-green-50 border-2 border-green-300 rounded-xl p-6 fade-in">
                    <h2 class="text-2xl font-bold text-green-800 mb-4 flex items-center gap-2">
                        <span class="text-3xl">‚úÖ</span>
                        <span>Calcul Finalizat</span>
                    </h2>
                    <div class="text-5xl sm:text-6xl font-bold text-green-600 my-6 text-center">
                        ${pr.toFixed(2)} RON
                    </div>
                    <p class="text-center text-green-800 font-semibold mb-6">
                        Prima RecomandatƒÉ pentru 12 luni
                    </p>

                    <div class="bg-white rounded-lg p-6 mt-4">
                        <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <span>üìä</span>
                            <span>Detalii calcul pas cu pas:</span>
                        </h4>
                        <ol class="space-y-2 text-sm text-gray-700">
                            <li><strong>1.</strong> Media ofertelor: (${inputs.PO1} + ${inputs.PO2} + ${inputs.PO3}) √∑ 3 = <strong>${details.step1_averagePO} RON</strong></li>
                            <li><strong>2.</strong> 64% din medie: ${details.step1_averagePO} √ó 0.64 = <strong>${details.step2_poComponent} RON</strong></li>
                            <li><strong>3.</strong> TR √ó N: ${inputs.TR} √ó 1.36 = <strong>${details.step3_trComponent} RON</strong></li>
                            <li><strong>4.</strong> Suma: ${details.step3_trComponent} + ${details.step2_poComponent} = <strong>${details.step4_sum} RON</strong></li>
                            <li><strong>5.</strong> Rezultat final: ${details.step4_sum} √∑ 2 = <strong class="text-green-600 text-lg">${pr.toFixed(2)} RON</strong></li>
                        </ol>
                    </div>
                </div>
            `;
            manualResult.classList.remove('hidden');
        }

        // ========================================
        // AUTOMATED FORM HANDLER
        // ========================================
        const autoForm = document.getElementById('autoForm');
        const uploadArea = document.getElementById('upload-area');
        const pdfInput = document.getElementById('pdf-input');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');
        const autoSubmitBtn = document.getElementById('auto-submit-btn');
        const autoResetBtn = document.getElementById('auto-reset-btn');
        const autoLoading = document.getElementById('auto-loading');
        const autoResult = document.getElementById('auto-result');

        let selectedFile = null;

        // Upload area click
        uploadArea.addEventListener('click', () => pdfInput.click());

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                pdfInput.files = files;
                handleFileSelect(files[0]);
            } else {
                alert('VƒÉ rugƒÉm sƒÉ √ÆncƒÉrca»õi un fi»ôier PDF valid.');
            }
        });

        // File selection
        pdfInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            selectedFile = file;
            fileName.textContent = `üìÑ ${file.name}`;
            fileSize.textContent = `Dimensiune: ${(file.size / 1024).toFixed(2)} KB`;

            fileInfo.classList.remove('hidden');
            autoSubmitBtn.disabled = false;
            autoResetBtn.classList.remove('hidden');
            uploadArea.style.display = 'none';
        }

        // Reset
        autoResetBtn.addEventListener('click', () => {
            selectedFile = null;
            pdfInput.value = '';
            fileInfo.classList.add('hidden');
            autoSubmitBtn.disabled = true;
            autoResetBtn.classList.add('hidden');
            uploadArea.style.display = 'block';
            autoResult.classList.add('hidden');
        });

        // Form submission
        autoForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!selectedFile) {
                alert('VƒÉ rugƒÉm sƒÉ selecta»õi un fi»ôier PDF.');
                return;
            }

            autoSubmitBtn.disabled = true;
            autoLoading.classList.remove('hidden');
            autoResult.classList.add('hidden');

            try {
                const formData = new FormData();
                formData.append('data', selectedFile);

                const response = await fetch(WEBHOOK_AUTO, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                autoLoading.classList.add('hidden');
                autoSubmitBtn.disabled = false;

                if (result.success) {
                    showAutoSuccess(result);
                } else {
                    showError(autoResult, result.message || 'Eroare la procesare', result.errors, result.extractedData);
                }
            } catch (error) {
                autoLoading.classList.add('hidden');
                autoSubmitBtn.disabled = false;
                showError(autoResult, 'Eroare de conexiune. Verifica»õi dacƒÉ n8n ruleazƒÉ.', [error.message]);
            }
        });

        function showAutoSuccess(result) {
            const pr = result.result.primaRecomandata;
            const extracted = result.extractedData;
            const details = result.calculationDetails;

            autoResult.innerHTML = `
                <div class="bg-green-50 border-2 border-green-300 rounded-xl p-6 fade-in">
                    <h2 class="text-2xl font-bold text-green-800 mb-4 flex items-center gap-2">
                        <span class="text-3xl">‚úÖ</span>
                        <span>Calcul Finalizat Automat</span>
                    </h2>
                    <div class="text-5xl sm:text-6xl font-bold text-green-600 my-6 text-center">
                        ${pr.toFixed(2)} RON
                    </div>
                    <p class="text-center text-green-800 font-semibold mb-6">
                        Prima RecomandatƒÉ pentru 12 luni
                    </p>

                    <div class="bg-white rounded-lg p-6 mt-4">
                        <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                            <span>üìä</span>
                            <span>Date Extrase din PDF:</span>
                        </h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">Tip PersoanƒÉ:</span>
                                <strong class="text-gray-800">${extracted.tipPersoana}</strong>
                            </div>
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">Jude»õ:</span>
                                <strong class="text-gray-800">${extracted.judet}</strong>
                            </div>
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">Putere Motor:</span>
                                <strong class="text-gray-800">${extracted.putereKW} KW</strong>
                            </div>
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">TR:</span>
                                <strong class="text-gray-800">${result.inputs.TR} RON</strong>
                            </div>
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">PO1:</span>
                                <strong class="text-gray-800">${extracted.PO1} RON</strong>
                            </div>
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">PO2:</span>
                                <strong class="text-gray-800">${extracted.PO2} RON</strong>
                            </div>
                            <div class="flex justify-between border-b pb-2">
                                <span class="text-gray-600">PO3:</span>
                                <strong class="text-gray-800">${extracted.PO3} RON</strong>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg p-6 mt-4">
                        <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <span>üßÆ</span>
                            <span>Pa»ôi de Calcul:</span>
                        </h4>
                        <ol class="space-y-2 text-sm text-gray-700">
                            <li><strong>1.</strong> Media: (${extracted.PO1} + ${extracted.PO2} + ${extracted.PO3}) √∑ 3 = <strong>${details.step1_averagePO} RON</strong></li>
                            <li><strong>2.</strong> 64%: ${details.step1_averagePO} √ó 0.64 = <strong>${details.step2_poComponent} RON</strong></li>
                            <li><strong>3.</strong> TR √ó N: ${result.inputs.TR} √ó 1.36 = <strong>${details.step3_trComponent} RON</strong></li>
                            <li><strong>4.</strong> Suma: ${details.step3_trComponent} + ${details.step2_poComponent} = <strong>${details.step4_sum} RON</strong></li>
                            <li><strong>5.</strong> Rezultat: ${details.step4_sum} √∑ 2 = <strong class="text-green-600 text-lg">${pr.toFixed(2)} RON</strong></li>
                        </ol>
                    </div>
                </div>
            `;
            autoResult.classList.remove('hidden');
        }

        // ========================================
        // ERROR DISPLAY
        // ========================================
        function showError(container, message, errors = [], extractedData = null) {
            let html = `
                <div class="bg-red-50 border-2 border-red-300 rounded-xl p-6 fade-in">
                    <h2 class="text-xl font-bold text-red-800 mb-3 flex items-center gap-2">
                        <span class="text-2xl">‚ùå</span>
                        <span>Eroare</span>
                    </h2>
                    <p class="text-red-700 mb-3">${message}</p>
            `;

            if (errors && errors.length > 0) {
                html += `
                    <div class="bg-white rounded-lg p-4 mt-3">
                        <h4 class="font-semibold text-red-800 mb-2">Detalii:</h4>
                        <ul class="list-disc list-inside text-sm text-red-700 space-y-1">
                            ${errors.map(err => `<li>${err}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            if (extractedData) {
                html += `
                    <div class="bg-white rounded-lg p-4 mt-3">
                        <h4 class="font-semibold text-gray-800 mb-2">Date Par»õial Extrase:</h4>
                        <pre class="text-xs text-gray-600 overflow-x-auto">${JSON.stringify(extractedData, null, 2)}</pre>
                    </div>
                `;
            }

            html += '</div>';
            container.innerHTML = html;
            container.classList.remove('hidden');
        }

        // ========================================
        // INIT
        // ========================================
        console.log('üöó Calculator RCA - Risc Ridicat initialized');
    </script>
</body>
</html>
